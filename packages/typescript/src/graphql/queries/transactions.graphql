# Copyright (c) Mysten Labs, Inc.
# SPDX-License-Identifier: Apache-2.0

query simulateTransaction($transaction: JSON!) {
	simulateTransaction(transaction: $transaction) {
		error
		effects {
			transaction {
				...TRANSACTION_FIELDS
			}
		}
	}
}

mutation executeTransaction($transactionDataBcs: Base64!, $signatures: [Base64!]!) {
	executeTransaction(transactionDataBcs: $transactionDataBcs, signatures: $signatures) {
		errors
		effects {
			transaction {
				...TRANSACTION_FIELDS
			}
		}
	}
}

query getTransactionBlock($digest: String!) {
	transaction(digest: $digest) {
		...TRANSACTION_FIELDS
	}
}

fragment TRANSACTION_FIELDS on Transaction {
	digest
	transactionBcs
	signatures {
		signatureBytes
	}
	effects {
		effectsBcs
		epoch {
			epochId
		}
		unchangedConsensusObjects {
			nodes {
				__typename
				... on ConsensusObjectRead {
					object {
						asMoveObject {
							address
							contents {
								type {
									repr
								}
							}
						}
					}
				}
			}
		}
		objectChanges {
			nodes {
				address
				inputState {
					version
					asMoveObject {
						address
						contents {
							type {
								repr
							}
						}
					}
				}
				outputState {
					asMoveObject {
						address
						contents {
							type {
								repr
							}
						}
					}
				}
			}
		}
		balanceChanges(first: 50) {
			pageInfo {
				hasNextPage
			}
			nodes {
				owner {
					address
				}
				coinType {
					repr
				}
				amount
			}
		}
	}
}
